define("disk-system:widget/plugin/download/log.js",function(){return{event:{},ajax:{"/api/download":{logType:"dis",description:"下载文件",callback:function(e,o){return[{name:"downloadHttpTime",value:o&&o.time},{name:"downloadHttpStatus",value:o&&o.responseData&&o.responseData.errno}]}}},mix:{chromeStraightforwardDownload:{discription:"chrome直接下载文件"}}}});
;define("disk-system:widget/plugin/download/util/context.js",function(t,n,e){var o={context:null},i=t("disk-system:widget/plugin/download/log.js"),d={getContext:function(){return o.context},setContext:function(t){o.context=t,t&&t.log&&t.log.define(i)}};e.exports=d});
;define("disk-system:widget/plugin/download/service/dlinkService.js",function(t,r,e){var n=t("base:widget/libs/jquerypacket.js"),i=t("system-core:context/context.js"),a={PRODUCT_PAN:"pan",PRODUCT_MBOX:"mbox",PRODUCT_SHARE:"share",currentProduct:null,dialog:null,setCurrentProduct:function(t){this.currentProduct=t},getCurrentProduct:function(){return this.currentProduct},URL_DLINK_PAN:"/api/download",URL_DLINK_SHARE:"/api/sharedownload",_doError:function(t){var r="",e=this;if(2==t&&(r="下载失败，请稍候重试"),116===t&&(r="该分享不存在！"),-1===t&&(r="您下载的内容中包含违规信息！"),118===t&&(r="没有下载权限！"),113===t&&(r='页面已过期，请<a href="javascript:window.location.reload();">刷新</a>后重试'),-20===t)return void e._showVerifyDialog();121===t&&(r="你选择操作的文件过多，减点试试吧。"),r=r||"网络错误，请稍候重试";new i.instanceForSystem.ui.tip({mode:"caution",msg:r,hasClose:!1,autoClose:!0})},getFsidListData:function(t){return _.isArray(t)===!1&&(t=[t]),n.stringify(_.pluck(t,"fs_id"))},base64Encode:function(t){var r,e,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(n=t.length,e=0,r="";n>e;){if(i=255&t.charCodeAt(e++),e==n){r+=s.charAt(i>>2),r+=s.charAt((3&i)<<4),r+="==";break}if(a=t.charCodeAt(e++),e==n){r+=s.charAt(i>>2),r+=s.charAt((3&i)<<4|(240&a)>>4),r+=s.charAt((15&a)<<2),r+="=";break}o=t.charCodeAt(e++),r+=s.charAt(i>>2),r+=s.charAt((3&i)<<4|(240&a)>>4),r+=s.charAt((15&a)<<2|(192&o)>>6),r+=s.charAt(63&o)}return r},getDlinkPan:function(t,r,e,i,a,o){var s,c,u,d=this;try{u=new Function("return "+yunData.sign2)()}catch(p){throw new Error(p.message)}return"function"!=typeof u?void this._doError():("[object Array]"===Object.prototype.toString.call(t)?t=n.stringify(t):"string"!=typeof t||/^\[\S+\]$/.test(t)||(t="["+t+"]"),s=d.base64Encode(u(yunData.sign3,yunData.sign1)),c={sign:s,timestamp:yunData.timestamp,fidlist:t,type:r},i&&a&&(c.ct=i,c.cv=a),void n.ajax({url:this.URL_DLINK_PAN,data:c,dataType:"json",type:o||"GET",success:function(t){0==t.errno?t.dlink&&t.dlink.length>0?"function"==typeof e&&e(t):d._doError():d._doError(t.errno)},error:function(){d._doError()}}))},ajaxGetDlinkShare:function(){var t={encrypt:0};0===yunData.SHARE_PUBLIC&&(t.extra=n.stringify({sekey:new i.instanceForSystem.tools.baseService.getCookie("BDCLND")}));var r=function(){n.get("/share/autoincre",{type:1,uk:yunData.SHARE_UK,shareid:yunData.SHARE_ID,sign:yunData.SIGN,timestamp:yunData.TIMESTAMP})};return function(e,i){var a=this,o=n.extend({},t,e),s=o.sign,c=o.timestamp;delete o.sign,delete o.timestamp,n.post(this.URL_DLINK_SHARE+"?sign="+s+"&timestamp="+c,o,function(t){var e=null;try{e=n.parseJSON(t)}catch(s){}e?0==e.errno?(o.product===a.PRODUCT_SHARE&&r(),"function"==typeof i&&i(e)):a._doError(e.errno):a._doError()}).error(function(){a._doError()})}}(),getDlinkMbox:function(){var t=function(t){var r={uk:yunData.MYUK,product:a.PRODUCT_MBOX,encrypt:0,timestamp:"",sign:""},e={};return t.vcode&&(e.vcode=t.vcode,e.input=t.input),t.isForBatch===!0&&(e.type="batch"),t.isForGuanjia===!0&&(e.encrypt=1),t.ct&&t.cv&&(e.ct=t.ct,e.cv=t.cv),e=t.group_id?n.extend({},r,e,{primaryid:t.msg_id,fid_list:a.getFsidListData(t.list),extra:n.stringify({type:"group",gid:t.group_id})}):n.extend({},r,e,{primaryid:t.msg_id,fid_list:a.getFsidListData(t.list),extra:n.stringify({type:"single",from_uk:t.from_uk,to_uk:t.to_uk})})};return function(r,e){this.arguments=arguments,this.ajaxGetDlinkShare(t(r),e)}}(),getDlinkShare:function(){var t=function(t){var r={product:a.PRODUCT_SHARE,encrypt:0,timestamp:"",sign:""},e={};return t.vcode_input&&t.vcode_str&&(e.vcode_input=t.vcode_input,e.vcode_str=t.vcode_str),t.isForBatch===!0&&(e.type="batch"),t.isForGuanjia===!0&&(e.encrypt=1),t.ct&&t.cv&&(e.ct=t.ct,e.cv=t.cv),e=n.extend({},r,e,{uk:t.share_uk,primaryid:t.share_id,fid_list:a.getFsidListData(t.list),sign:t.sign,timestamp:t.timestamp})};return function(r,e){this.arguments=arguments,this.ajaxGetDlinkShare(t(r),e)}}(),_showVerifyDialog:function(){var t=this;t.dialog=i.instanceForSystem.ui.verify({title:"提示",hasError:!0,prod:"pan",onSure:function(r,e){t.arguments[0]=r,t.arguments[1]=e,t.arguments.callee.apply(t,t.arguments)}}),t.dialog.show()}};e.exports=a});
;define("disk-system:widget/plugin/download/util/downloadCommonUtil.js",function(e,t,s){var o=e("base:widget/libs/jquerypacket.js"),n=e("disk-system:widget/plugin/download/service/dlinkService.js"),i=(e("disk-system:widget/system/util/FELog.js"),e("disk-system:widget/plugin/download/util/context.js")),a={getDownloadLogmsg:function(){var e;return e=n.getCurrentProduct()===n.PRODUCT_SHARE?2:1},useToast:function(e){i.getContext().ui.tip({mode:e.toastMode,msg:e.msg})},useCloseToast:function(){i.getContext().ui.hideTip()},getPackName:function(e){var t,s=i.getContext().tools.baseService.parseDirFromPath(e[0].path),o=e[0].isdir;return"number"!=typeof e.length?i.getContext().tools.baseService.parseDirFromPath(e[0].path):e.length>1?(0===o&&(t=s.lastIndexOf("."),-1!==t&&(s=s.substring(0,t))),"【批量下载】"+s+"等.zip"):void 0},isFile:function(e){return 0===e||void 0===e?!0:!1},isPlatformWindows:function(){var e=navigator.platform;return 0===e.toLowerCase().indexOf("win")},getDownloadUrl:function(e){return o.browser.msie?e.dlink+"&response-cache-control=private":e.dlink},isChromeAndGreaterThan42:function(){var e,t="42",s=navigator.userAgent.toLowerCase(),o=/chrome/,n=/safari\/\d{3}\.\d{2}$/,i=/chrome\/(\S+)/;return o.test(s)&&n.test(s)&&i.test(s)?(e=RegExp.$1,e>t?!0:!1):!1},isChrome:function(){var e=navigator.userAgent.toLowerCase(),t=/chrome/;return t.test(e)?!0:!1},toLogin:function(){var t=this;this.useToast({toastMode:"loading",msg:"请稍候..."}),e.async("base:widget/passAPI/passAPI.js",function(e){t.useCloseToast(),e.promise.done(function(){e.passAPI.PassportInit.netdiskLogin({reload:!0}),e.passAPI.PassLoginDialog.onLoginSuccessCallback=function(){e.passAPI.PassportInit.hide(),i.getContext().log.send({type:"download_share_single_size_limit_login_success"})}}),i.getContext().log.send({type:"download_share_single_size_limit_login_dialog_show"})})}};s.exports=a});
;define("disk-system:widget/plugin/download/util/pcsUtil.js",function(t){var s=t("base:widget/libs/jquerypacket.js"),e={};e.testPCSCDNConnectivity=function(t){e._getHostList(t)},e._sList=null,e._sIndex=-1,e._sConnectedIndex=-1,e._sResult=0,e._path=null,e._sRevision=0,e._getHostList=function(t){s.ajax({url:"https://d.pcs.baidu.com/rest/2.0/pcs/manage?method=listhost&t="+(new Date).getTime(),method:"get",dataType:"jsonp",success:function(s){s&&s.list&&(e._path=s.path,e._sList=s.list,e._sRevision=s.rev||0,e._startTesting(t))},error:function(){"function"==typeof t&&t.call(e,0)}})},e._startTesting=function(t){e._sIndex++;var s=e._sList[e._sIndex];if(e._sIndex<e._sList.length){var n=new Image;n.onload=function(){e._sConnectedIndex=e._sIndex,e._sResult+=s.id,e._startTesting(t)},n.onerror=function(){e._startTesting(t)},n.src="//"+s.host+(e._path||"/monitor.jpg?xcode=1a81b0bbd448fc368d78cc336e28561a")+(new Date).getTime()}else"function"==typeof t&&t.call(e,1,e._sConnectedIndex,e._sList,e._sResult,e._sRevision,e._path)},e.testPCSCDNConnectivity()});
;define("disk-system:widget/plugin/download/service/downloadDirectService.js",function(o,e,n){var t=o("base:widget/libs/jquerypacket.js"),d=o("disk-system:widget/plugin/download/util/downloadCommonUtil.js"),i=o("disk-system:widget/plugin/download/util/pcsUtil.js"),a=o("disk-system:widget/plugin/download/util/context.js"),l={SINGLE_DOWNLOAD:"http://pcs.baidu.com/rest/2.0/pcs/file?method=download&app_id=250528",MULTI_DOWNLOAD:"https://pcs.baidu.com/rest/2.0/pcs/file?method=batchdownload&app_id=250528",downloadDom:null,_warmupHTML:function(){var o=this.downloadDom,e=[];null==o&&(o=document.createElement("div"),o.className="pcs-hide-ele",document.body.appendChild(o),e.push('<iframe src="javascript:;" id="pcsdownloadiframe" name="pcsdownloadiframe" style="display:none"></iframe>'),e.push('<form target="pcsdownloadiframe" enctype="application/x-www-form-urlencoded" action="'+this.MULTI_DOWNLOAD+'" method="post" name="pcsdownloadform">'),e.push('<input name="method" value="batchdownload" type="hidden" /><input name="zipcontent" type="hidden" /><input name="zipname" type="hidden" /></form>'),o.innerHTML=e.join(""),this.downloadDom=o)},log:{straightforwardDownload:function(o){var e="";try{e=_.isArray(o)===!1?"downloadfile|downloadSize_"+o.size+"|downloadFileLength_1|downloadFileCategory_."+o.path.split(".")[o.path.split(".").length-1]:"downloadfile|downloadFileLength_"+o.length,a.getContext().log.send({page:d.getDownloadLogmsg(),type:e,md5:o.md5||"proxypcs"}),/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)&&a.getContext().log.send({name:"chromeStraightforwardDownload",sendServerLog:!1,value:"chrome"})}catch(n){}},_showDownloadingDialog:function(){try{a.getContext().log.send({page:d.getDownloadLogmsg(),type:"download_browser_lteq_ie8"})}catch(o){}}},_switchDownloadTips:function(o){var e=t.browser,n=!1;e.msie&&parseInt(e.version,10)<=8&&(n=!0),n===!0?this._showDownloadingDialog(o):this._doDownloadFile(o)},_doDownloadFile:function(o){var e=null;this._warmupHTML(),e=document.getElementById("pcsdownloadiframe"),e.src=this._obtainDownloadURL(o)},_obtainDownloadURL:function(o){var e="",n=o.dlink;return i&&i._sResult&&(e="&cflg="+encodeURIComponent(i._sResult+":"+i._sRevision),n+=e),n&&0===n.indexOf("http://")&&"https:"===window.location.protocol&&(n=n.replace("http://",window.location.protocol+"//")),t.browser.msie&&(n+="&response-cache-control=private"),n},_showDownloadingDialog:function(o){var e=this,n=null,t={title:"提示",body:"下载链接已生成，请点击下载。",sureText:"立即下载",onSure:function(){n.hide(),e._doDownloadFile(o),l.log._showDownloadingDialog()}};n=a.getContext().ui.confirm(t),n.show()}},s={straightforwardDownload:function(o,e){l._switchDownloadTips(o),l.log.straightforwardDownload(e)}};n.exports=s});
;define("disk-system:widget/plugin/download/service/guanjiaConnector.js",function(e,o,n){var t=e("disk-system:widget/plugin/download/util/downloadCommonUtil.js"),i=e("base:widget/libs/jquerypacket.js"),c=e("base:widget/httpProxy/httpProxy.js"),a={},r={};a={conf:{localUrl:"http://127.0.0.1",localPort:1e4,currentPort:1e4,portPollLimit:10,guanjiaVersion:0,localServerReady:!1,domIframeId:"guanjia-iframe-id",domHookId:"guanjia-hook-id",hook:null,minVersion:"5.3.4.5"},util:{init:function(){a.util.checkLocalServer(),t.isChromeAndGreaterThan42()||setTimeout(function(){a.util.localServerReady||a.util.installHook()},400)},checkLocalServer:function(){if(!a.conf.localServerReady&&t.isPlatformWindows())for(var e=function(e){var o=a.conf.localUrl+":"+e+"/guanjia",n={url:o,type:"get",data:{method:"GetVersion"},timeout:200,success:function(o){try{o=i.parseJSON(o)}catch(n){}if(o&&o.version){if(o.version<a.conf.minVersion)return;a.conf.currentPort=e,a.conf.guanjiaVersion=o.version,a.conf.localServerReady=!0}}};location.protocol.indexOf("https")>-1?c.ajax(n):i.ajax(n)},o=0;o<a.conf.portPollLimit;o++)e(a.conf.localPort+o)},installHook:function(){var e,o,n=[];return null!==a.conf.hook?a.conf.hook:(e=document.getElementById(a.conf.domIframeId),e&&document.body.removeChild(e),e=document.createElement("div"),e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.overflow="hidden",e.style.left="-999em",e.style.top="-999em",e.id=a.conf.domIframeId,document.body.appendChild(e),n.push("undefined"!=typeof window.attachEvent||window.ActiveXObject||"ActiveXObject"in window?'<object id="'+a.conf.domHookId+'" classid="CLSID:8DCE7B6C-C3B9-4efd-9CC6-2D9F938B4A06" hidden="true" viewastext></OBJECT>':-1!==navigator.userAgent.indexOf("Trident/7.0")?'<embed id="'+a.conf.domHookId+'" type="application/bd-npYunWebDetect-plugin" width="0" height="0">':'<embed id="'+a.conf.domHookId+'" type="application/bd-npYunWebDetect-plugin" width="0" height="0">'),e.innerHTML=n.join(""),o=a.util.hasPlugin(),o&&(a.conf.hook=document.getElementById(a.conf.domHookId),a.conf.guanjiaVersion=a.conf.hook.GetVersion()),a.conf.hook)},hasPlugin:function(){var e=null;try{e=new ActiveXObject("YunWebDetect.YunWebDetect.1")}catch(o){for(var n=null,t=navigator.plugins,i=0,c=t.length;c>i;i++)if(n=t[i].name||t[i].filename,-1!=n.indexOf("BaiduYunGuanjia")){e=t[i];break}}return null!=e},checkPluginHook:function(){return a.conf.installHook()},sendData:function(e,o,n,t,r){if(a.conf.localServerReady){var l=a.conf.localUrl+":"+a.conf.currentPort+"/guanjia?";l+="method="+e+"&uk="+n+"&checkuser="+(t?1:0);var u={url:l,type:"post",data:{filelist:o},success:function(){},timeout:3e3,error:function(){r||(a.conf.localServerReady=!1,a.util.checkLocalServer(),setTimeout(function(){a.util.sendData(e,o,n,t,!0)},1e3))}};location.protocol.indexOf("https")>-1?c.ajax(u):i.ajax(u)}else{if(!a.conf.hook)return-2;try{"undefined"==typeof t?a.conf.hook[e](o,n):a.conf.hook[e](o,n,t)}catch(d){return-2}}}}},r={getVersion:function(){return a.conf.guanjiaVersion},checkConnect:function(){return a.conf.localServerReady?!0:t.isChromeAndGreaterThan42()?!1:a.conf.hook&&a.conf.guanjiaVersion?!0:!1},callGuanjia:function(e,o,n,t){return a.util.sendData(e,o,n,t)},init:function(){a.util.init()}},n.exports=r});
;define("disk-system:widget/plugin/download/service/downloadGuanjiaService.js",function(n,e,a){var t=n("base:widget/libs/jquerypacket.js"),i=n("disk-system:widget/plugin/download/util/downloadCommonUtil.js"),o=n("disk-system:widget/plugin/download/service/dlinkService.js"),r=n("disk-system:widget/plugin/download/service/guanjiaConnector.js"),s={GUANJIA_VERSION_COMPARE:"4.8.0",GUANJIA_VERSION_DEFAULT:"5.3.4",GUANJIA_VERSION_NEW:null,GUANJIA_VERSION_NEW_XP:"4.7.6",fetchGuanjiaVersion:function(){var n=function(n){var e=n.split("V"),a=e[1],t=/^\d{1,2}\.\d{1,2}\.\d{1,2}$/;return t.test(a)===!0?a:s.GUANJIA_VERSION_DEFAULT};return function(){var e=this;t.ajax({url:"/disk/cmsdata",data:{"do":"download"},type:"GET",dataType:"JSON",cache:!1,async:!1,success:function(a){var i,o;if(0===a.errorno)if(a.content)try{i=t.parseJSON(a.content),o=n(i.version),e.setGuanjiaVersion(o)}catch(r){e.setGuanjiaVersion(e.GUANJIA_VERSION_DEFAULT),disk.DEBUG&&console.log("The /disk/cmsdata interface is wrong and use the default version : "+e.GUANJIA_VERSION_DEFAULT)}else e.setGuanjiaVersion(e.GUANJIA_VERSION_DEFAULT),disk.DEBUG&&console.log("The version is null and use the default version : "+e.GUANJIA_VERSION_DEFAULT);else e.setGuanjiaVersion(e.GUANJIA_VERSION_DEFAULT),disk.DEBUG&&console.log("The version is wrong and use the default version : "+e.GUANJIA_VERSION_DEFAULT)},error:function(){e.setGuanjiaVersion(e.GUANJIA_VERSION_DEFAULT)}})}}(),setGuanjiaVersion:function(n){this.GUANJIA_VERSION_NEW=n},_hasPlugin:function(){var n=null;try{n=new ActiveXObject("YunWebDetect.YunWebDetect.1")}catch(e){for(var a=null,t=navigator.plugins,i=0,o=t.length;o>i;i++)if(a=t[i].name||t[i].filename,-1!=a.indexOf("BaiduYunGuanjia")){n=t[i];break}}return null!=n},_getFileListData:function(n){return t.stringify({filelist:n})}},u={GUANJIA_VERSION_COMPARE:"4.8.0",doError:function(n){var e=navigator.userAgent.toLowerCase(),a="启动百度云管家失败，请安装最新版本";/x64/g.test(e)===!0&&/msie\s[678]/i.test(e)===!0?a="加速下载暂不支持64位浏览器，请换个浏览器试试":e.indexOf("se 2.x")>-1?a="无法启动百度云管家，请换个浏览器试试":e.indexOf("360se")>-1?a="无法启动百度云管家，请换个浏览器试试":void 0===n?a="插件已被禁用，请查看浏览器插件设置":-2==n?a="启动百度云管家失败，请重启浏览器后重试":-4==n&&(a="检测到百度云管家已卸载，请重新安装后重试"),i.useToast({toastMode:"caution",msg:a})},getGuanjiaVersion:function(){return r.getVersion()},callClientDownload:function(n,e){var a,t,i,u=this;try{a=this.getGuanjiaVersion()}catch(d){return disk.DEBUG&&console.log("GetVersion()方法错误"),void this.doError()}switch(o.getCurrentProduct()){case o.PRODUCT_SHARE:try{a<s.GUANJIA_VERSION_COMPARE?(t=s._getFileListData(n),i=0===yunData.SHARE_PUBLIC?r.callGuanjia("DownloadPrivateShareItems",t):r.callGuanjia("DownloadPublicShareItems",t)):i=e?r.callGuanjia("DownloadShareItems",e,yunData.MYUK,!1):2,0>i&&u.doError(i)}catch(d){i=-2,u.doError(i)}break;case o.PRODUCT_MBOX:try{i=e?r.callGuanjia("DownloadShareItems",e,yunData.MYUK,!0):2,0>i&&u.doError(i)}catch(d){i=-2,u.doError(i)}break;default:t=s._getFileListData(n);try{i=a<s.GUANJIA_VERSION_COMPARE?r.callGuanjia("DownloadSelfOwnItems",t,yunData.MYNAME):r.callGuanjia("DownloadSelfOwnItems",t,yunData.MYUK+""),0>i&&u.doError(i)}catch(d){i=-2,u.doError(i)}}},getDownloadGuanjiaUrl:function(n){var e;return n?"http://bcscdn.baidu.com/netdisk/BaiduYunGuanjia_"+n+".exe":(e=navigator.userAgent,-1===e.indexOf("Windows NT 5.1")?(null===s.GUANJIA_VERSION_NEW&&s.fetchGuanjiaVersion(),"http://bcscdn.baidu.com/netdisk/BaiduYunGuanjia_"+s.GUANJIA_VERSION_NEW+".exe"):"http://bcscdn.baidu.com/netdisk/BaiduYunGuanjia_"+s.GUANJIA_VERSION_NEW_XP+".exe")},getDownloadGuanjiaUrlOfNew:function(){return null===s.GUANJIA_VERSION_NEW&&s.fetchGuanjiaVersion(),"http://bcscdn.baidu.com/netdisk/BaiduYunGuanjia_"+s.GUANJIA_VERSION_NEW+".exe"},checkAvailability:function(){return r.getVersion()},initConnector:function(){r.init()}};a.exports=u});
;define("disk-system:widget/plugin/download/service/downloadManager.js",function(i,t,e){var s=!1,o=i("base:widget/libs/jquerypacket.js"),a=i("disk-system:widget/plugin/download/util/context.js"),n=i("disk-system:widget/plugin/download/service/dlinkService.js"),d=i("disk-system:widget/plugin/download/util/downloadCommonUtil.js"),l=i("disk-system:widget/plugin/download/service/downloadDirectService.js"),r=i("disk-system:widget/plugin/download/service/downloadGuanjiaService.js"),h=window.yunData||h,g=function(i,t,e,s,o){this._mList=i,this._mIsFile=t,this._mPackName=e,this._mGuanjiaString=s,this._mOpts=o,this._mIspName=null,this._mIsVideoGuideMode=!(n.getCurrentProduct()===n.PRODUCT_SHARE||"mpage"===o.product_second),this._mIsVideo=this._mIsVideoGuideMode&&t?1===+i.category:!1,this._mIsChrome=d.isChromeAndGreaterThan42(),this.videoGuideText="",this.logMode=!1,this._mMsgId=disk.obtainId(),this._mPositiveId=disk.obtainId(),this._mNegativeId=disk.obtainId(),this._mPositiveVideoId=disk.obtainId(),this._mNegativeVideoId=disk.obtainId(),this._mClientHintId=disk.obtainId(),this._mDownloadTipsId=disk.obtainId(),this.dialog=null,this._mMode=g.MODE_PRE_DOWNLOAD,this._init(),this.queryIp()};g.DIALOG_ID="moduleDownloadDialog",g.MODE_PRE_DOWNLOAD=0,g.MODE_PRE_INSTALL=1,g.MODE_POST_INSTALL=2,g.MODE_POST_RETRY=3,g.MODE_DIRECT_DOWNLOAD=4,g.SIZE_SINGLE_SHARE=314572800,g.SIZE_THRESHOLD=734003200,g.SIZE_THRESHOLD_CHROME=943718400,g.SMALL_SIZE_FILE=52428800,g.MEDIUM_SIZE_FILE=536870912,g.SIZE_THRESHOLD_DEFAULT=500,g.SIZE_THRESHOLD_CHROME_DEFAULT=900,g.TO_SIZE_M=1048576,g.setThresholdSizeDefault=function(){g.SIZE_THRESHOLD=g.SIZE_THRESHOLD_DEFAULT*g.TO_SIZE_M,g.SIZE_THRESHOLD_CHROME=g.SIZE_THRESHOLD_CHROME_DEFAULT*g.TO_SIZE_M,disk.DEBUG&&console.log("The /disk/cmsdata interface is wrong and use the default version : "+g.SIZE_THRESHOLD_DEFAULT+", chrome-"+g.SIZE_THRESHOLD_CHROME_DEFAULT)},g.FILES_NUMBER=100,g.guanjiaVersion="",g.initSingleFileToGuanjiaLimit=function(){var i=!1;return function(){i!==!0&&(o.ajax({url:"/disk/cmsdata",data:{"do":"manual",ch:"download_limit"},type:"GET",dataType:"JSON",cache:!1,async:!1,timeout:5e3,success:function(i){var t;if(0===i.errorno)if(i.content)try{t=o.parseJSON(i.content)[0],t.download_limit?(t.download_limit=parseInt(t.download_limit,10),g.SIZE_THRESHOLD=t.download_limit*g.TO_SIZE_M):g.SIZE_THRESHOLD=g.SIZE_THRESHOLD_DEFAULT*g.TO_SIZE_M,t.download_limit_chrome?(t.download_limit_chrome=parseInt(t.download_limit_chrome,10),g.SIZE_THRESHOLD_CHROME=t.download_limit_chrome*g.TO_SIZE_M):g.SIZE_THRESHOLD_CHROME=g.SIZE_THRESHOLD_CHROME_DEFAULT*g.TO_SIZE_M}catch(e){g.setThresholdSizeDefault()}else g.setThresholdSizeDefault();else g.setThresholdSizeDefault()},error:function(){g.setThresholdSizeDefault()}}),i=!0)}}(),g.prototype._init=function(){this.initDialogDom()},g.prototype._event=function(){var i=this;o("#"+g.DIALOG_ID).delegate("#"+this._mPositiveId,"click",function(){return s&&console.log("dispatchPositiveEvent"),i.dispatchPositiveEvent()}),o("#"+g.DIALOG_ID).delegate("#"+this._mNegativeId,"click",function(){return s&&console.log("dispatchNegativeEvent"),i.dispatchNegativeEvent()}),o("#"+g.DIALOG_ID).delegate("#"+this._mPositiveVideoId,"click",function(){return s&&console.log("dispatchPositiveEvent"),a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"video_download_guide_positive_"+(i.logMode||i._mMode)}),i.dispatchPositiveEvent()}),o("#"+g.DIALOG_ID).delegate("#"+this._mNegativeVideoId,"click",function(){return s&&console.log("dispatchNegativeEvent"),a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"video_download_guide_negative_"+i._mMode}),i.dispatchNegativeEvent(),!1}),o("#"+g.DIALOG_ID).delegate(".playLink","click",function(){i.dialog.hide(),a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"video_download_guide_playclick_"+(i.logMode||i._mMode)})}),o("#"+g.DIALOG_ID).delegate("#goToBuy","click",function(){return a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"cilick_isp_buy"}),window.open("/buy/center?tag=2&frm=dl#network"),!1}),o("#goToBuyVip").click(function(){return a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"download_buyvip_click"}),window.open("//yun.baidu.com/buy/center?tag=8&from=speedup#question=vip-speed"),!1})},g.getDownloadUrl=function(i){return o.browser.msie?i.dlink+"&response-cache-control=private":i.dlink},g.prototype.setGuanjiaVersion=function(){g.guanjiaVersion||(g.guanjiaVersion=r.getGuanjiaVersion())},g.logMsg={category:"singleFileDownloadCategory",singleFileCategory:"singleFileDownloadCategory",multipleFileCategory:"multipleFileDownloadCategory",actionRecommendPlugin:"actionRecommendPluginDialog",actionCompulsoryPlugin:"actionCompulsoryPluginDialog",actionDownloadByPlugin:"actionDownloadByPluginAction",actionDownloadClient:"downloadClientAction",actionInstallClient:"installClientAction",actionAccelerateDownload:"accelerateDownloadAction",actionOrdinaryDownload:"ordinaryDownloadAction",actionDownReportIssue:"downReportIssueAction",opt_value:10},g.straightforwardDownload=function(i,t){l.straightforwardDownload(i,t)},g.prototype.initDialogDom=function(){var i=[];i.push('<div class="module-download-dialog">'),i.push('<div class="content">'),i.push('<div id="'+this._mMsgId+'_videoGuideBox" class="videoGuide">'),i.push('<div class="guideHeader"></div>'),i.push('<div class="guidePreview"></div>'),i.push("</div>"),i.push('<div id="'+this._mMsgId+'" class="message global-center">加载中&hellip;</div>'),i.push('<div id="'+this._mClientHintId+'" class="g-clearfix download-manage-client-hint g-center"></div>'),i.push('<div class="dlg-ft">'),i.push('<div class="g-clearfix g-center">'),i.push('<div class="videoBtnBox">'),i.push('<a href="javascript:;" id="'+this._mPositiveVideoId+'" class="g-button g-button-large g-button-blue-large">'),i.push('<span class="g-button-right">'),i.push('<span class="text">'+(h.ISSVIP&&1===+h.ISSVIP?'<em class="d-svip-icon"></em>超级会员极速下载':1===+h.ISVIP?'<em class="d-vip-icon"></em>会员高速下载':"高速下载（推荐）")+"</span>"),i.push("</span>"),i.push("</a>"),i.push('<a href="javascript:;" id="'+this._mNegativeVideoId+'" class="g-button g-button-large g-button-gray-large">'),i.push('<span class="g-button-right">普通下载</span>'),i.push('<i class="lineheight-ie7"></i>'),i.push("</a>"),i.push("</div>"),i.push('<div class="normalBtnBox">'),i.push('<a href="javascript:;" id="'+this._mPositiveId+'" node-type="download-speedup" class="g-button g-button-large g-button-blue-large">'),i.push('<span class="g-button-right">'),i.push('<span class="text">'+(h.ISSVIP&&1===+h.ISSVIP?'<em class="d-svip-icon"></em>超级会员极速下载':1===+h.ISVIP?'<em class="d-vip-icon"></em>会员高速下载':"高速下载（推荐）")+"</span>"),i.push("</span>"),i.push("</a>"),i.push('<a href="javascript:;"  id="'+this._mNegativeId+'" node-type="download-normal" class="g-button g-button-large g-button-gray-large">'),i.push('<span class="g-button-right">'),i.push('<span class="text">普通下载</span>'),i.push("</span>"),i.push("</a>"),i.push("</div>"),i.push("</div>"),i.push("</div>"),i.push("</div>"),i.push('<div class="dlg-ft01 b-rlv" id="show-acceleration-pack">'),i.push('<div class="g-clearfix center acceleration-pack">'),i.push('<span class="dowmload-imgs-style dowmload-imgs-style01"></span>'),i.push('<span class="dowmload-content-style">还想更快？购买网络加速包，最高</span>'),i.push('<span class="download-upspeed-style">提速40%</span>'),i.push('        <a href="javascript:;" id="goToBuy" class="g-button-small g-button abtn download-change-link-style">'),i.push('            <b class="g-button-right">立即提速</b>'),i.push("        </a>"),i.push("</div>"),i.push("</div>"),i.push('<div class="dlg-ft01 b-rlv" id="show-buyvip-pack" style="display:none;">'),i.push('    <div class="g-clearfix center buyvip-pack">'),i.push('        <span class="dowmload-imgs-style dowmload-imgs-style01"></span>'),i.push('        <span class="dowmload-content-style">买超级会员享提速特权，下载速度最高</span>'),i.push('        <span class="download-upspeed-style">提升200%</span>'),i.push('        <a href="javascript:;" id="goToBuyVip" class="g-button-small g-button abtn download-change-link-style">'),i.push('            <b class="g-button-right">立即提速</b>'),i.push("        </a>"),i.push("    </div>"),i.push("</div>"),this.dialogDom=i.join("")},g.prototype.initDialog=function(){this.dialog||(this.dialog=a.getContext().ui.window({id:g.DIALOG_ID,title:"文件下载",body:this.dialogDom,width:"568px"}),this._event())},g.prototype.setMode=function(i){this._mMode=i},g.prototype.setDependencyData=function(i,t,e,s,o){this._mList=i,this._mIsFile=t,this._mPackName=e,this._mGuanjiaString=s,this._mOpts=o,this._mIsVideo=this._mIsVideoGuideMode&&t?1===+i.category:!1},g.prototype._resolveDisplayName=function(){if("number"!=typeof this._mList.length)return this._mList.server_filename;var i=this._mPackName;if(this._mIsFile===!0){var t=i.lastIndexOf(".");-1!=t&&(i=i.substring(0,t))}return 1==this._mList.length?i:i+"等（<strong>"+this._mList.length+"</strong>）个文件"},g.prototype.isHugeFile=function(){var i=g.SIZE_THRESHOLD;return this._mIsChrome&&(i=g.SIZE_THRESHOLD_CHROME),"number"!=typeof this._mList.length&&this._mList.size>=i},g.prototype.isMediumFile=function(){return"number"!=typeof this._mList.length&&this._mList.size<g.SIZE_THRESHOLD&&this._mList.size>=g.SMALL_SIZE_FILE},g.prototype.isSmallFile=function(){return"number"!=typeof this._mList.length&&this._mList.size<=g.SMALL_SIZE_FILE},g.prototype.isBatchFiles=function(){return"number"==typeof this._mList.length},g.prototype.putIconifyName=function(i){var t,e,s,n,d="",l=a.getContext().file.getIconAndPlugin;i===!0?(this.dialog.$dialog.find(".dialog-header-title").text("高速下载"),this._mIsVideo?d+='<p class="download-mgr-dialog-title"></p>':d='<p class="download-mgr-dialog-icon"></p><p class="download-mgr-dialog-title">百度云管家</p>',d+='<p class="download-mgr-dialog-text">快速、稳定下载大文件，需要使用百度云管家，还支持断点续传哟~</p>'):d='<span class="fileicon"></span>'+this._resolveDisplayName(),o("#"+this._mMsgId).html(d),n=o(".fileicon","#"+this._mMsgId),this._mList.length>1?(this._mList instanceof Array&&(s=this._mList[0]),t=a.getContext().file.getIconAndPlugin(s.path,1,!0).smallIcon):(s=this._mList instanceof Array?this._mList[0]:this._mList,1==s.isdir?t=l(s.path,1).smallIcon:(e=s.path,t=l(e,0).smallIcon)),n.addClass(t),n.css("margin-right","8px")},g.prototype.videoTypePreview=function(i,t){var e=o("#"+this._mMsgId+"_videoGuideBox"),s=e.find(".guideHeader"),n=e.find(".guidePreview"),l=this._mList,r=this,_=o("#"+this._mPositiveVideoId).parent(),c=o("#"+this._mPositiveId).parent();if(this._mIsVideo){var p=o('<a target="_blank" class="playLink" href="/play/video#video/path='+encodeURI(l.path)+'&t=-1"><div class="playBox"><i title="播放" class="playIcon"></i><span class="playText">点击播放</span></div></a>'),m="";l.thumbs&&l.thumbs.url2&&(m=l.thumbs.url2),n.html(p).attr("style","background:url("+m+") 50% 50% no-repeat").show();var u=g.SIZE_THRESHOLD;if(this._mIsChrome&&(u=g.SIZE_THRESHOLD_CHROME),l.size>u?s.html("<span>"+this.videoGuideText+"</span></div>").show():s.html('<div class="decorLine"></div><span>'+this.videoGuideText+'</span><div class="decorLine lineR"></div>').show(),r._mMode===g.MODE_POST_INSTALL?(_.hide(),c.show()):(_.show(),c.hide()),r._mMode!==g.MODE_POST_INSTALL||t||i){if(r.logMode=!1,t&&r._mMode===g.MODE_POST_INSTALL)return;if(i&&(r._mMode===g.MODE_POST_RETRY||r._mMode===g.MODE_PRE_INSTALL))return}else r.logMode=3;a.getContext().log.send({page:d.getDownloadLogmsg(),url:"//pan.baidu.com/api/analytics",type:"video_download_guide_window_"+(r.logMode||r._mMode)}),this._mIspName&&1===+h.ISSVIP?o("#show-acceleration-pack").fadeIn("200"):1!==+h.ISSVIP&&this.showBuyVipPkgGuide()}else s.hide(),n.hide(),_.hide(),c.show();this.dialog.position("center")},g.prototype.updateMode=function(i,t){var e=this;switch(s&&console.log("this mode is:"+this._mMode),o("div.chromeUpgradeHelpTip",this.dialog).remove(),this._mMode){case g.MODE_PRE_DOWNLOAD:this.videoGuideText="点击立即播放，无需下载即可在线观看视频",this._mIspName&&1===+h.ISSVIP?o("#show-acceleration-pack").fadeIn("200"):1!==+h.ISSVIP&&this.showBuyVipPkgGuide(),o("#"+this._mClientHintId).css("display","none"),o("#"+this._mMsgId).removeClass("download-mgr-tight"),this.putIconifyName(),this._mIsVideo&&(o(".g-button-right span","#"+this._mPositiveVideoId).html(h.ISSVIP&&1===+h.ISSVIP?'<em class="d-svip-icon"></em>超级会员极速下载':1===+h.ISVIP?'<em class="d-vip-icon"></em>会员高速下载':"高速下载（推荐）"),o("#"+this._mPositiveVideoId).attr("href","javascript:;").css("display",""),o("#"+this._mNegativeVideoId).html('<span class="g-button-right">普通下载</span>'),o("#"+this._mNegativeVideoId).css("display","")),o(".g-button-right span","#"+this._mPositiveId).html(h.ISSVIP&&1===+h.ISSVIP?'<em class="d-svip-icon"></em>超级会员极速下载':1===+h.ISVIP?'<em class="d-vip-icon"></em>会员高速下载':"高速下载（推荐）"),o("#"+this._mPositiveId).attr("href","javascript:;").css("display",""),o(".g-button-right","#"+this._mNegativeId).text("普通下载"),o("#"+this._mNegativeId).css("display",""),this.dialog.$dialog.find(".dialog-header-title").text("文件下载"),s&&console.log("display download options"),a.getContext().log.send({type:g.logMsg.category+"-"+g.logMsg.actionRecommendPlugin}),navigator.userAgent.toLowerCase().search(/chrome|chromium/)>0&&!r.checkAvailability()&&o("#"+this._mPositiveId).attr("href","Baiduyunguanjia://guanjia"),this.dialog.show();break;case g.MODE_PRE_INSTALL:o("#"+this._mMsgId).addClass("download-mgr-tight"),o("#"+this._mPositiveId).css("display",""),o("#"+this._mPositiveVideoId).css("display",""),o(".text","#"+this._mPositiveId).text("安装最新版百度云管家"),o(".text","#"+this._mPositiveVideoId).text("安装最新版百度云管家"),o("#"+this._mPositiveId).attr("href","javascript:;"),o("#"+this._mPositiveVideoId).attr("href","javascript:;"),o("#"+this._mNegativeId).css("display","none"),o("#"+this._mNegativeVideoId).css("display","none"),o("#"+this._mDownloadTipsId).css("display","none"),o("#"+this._mClientHintId).css("display","none"),this.dialog.$dialog.find(".dialog-header-title").text("文件下载");var l=!0,_=g.SIZE_THRESHOLD;if(this._mIsChrome&&(_=g.SIZE_THRESHOLD_CHROME),"number"!=typeof this._mList.length)this._mList.size>_?(this._mIsVideo?this.videoGuideText="你下载的文件过大，需要使用百度云管家或点击预览在线观看":o("#"+this._mClientHintId).html("你下载的文件过大，需要使用百度云管家。").show(),l=!1):(o("#show-acceleration-pack").hide(),o("#show-buyvip-pack").hide(),o("#"+this._mClientHintId).html("").hide());else if("number"==typeof this._mList.length){for(var c=0,p=0,m=0;m<this._mList.length;m++)c+=this._mList[m].size,1==this._mList[m].isdir?p=1:"";n.getCurrentProduct()!==n.PRODUCT_MBOX?(c>g.MEDIUM_SIZE_FILE||this._mList.length>g.FILES_NUMBER)&&(o("#"+this._mClientHintId).html("你下载的文件过大或者过多，需要使用百度云管家。").show(),l=!1):(c>g.MEDIUM_SIZE_FILE||this._mList.length>50)&&(o("#"+this._mClientHintId).html("你下载的文件过大或者过多，需要使用百度云管家。").show(),l=!1),1==p?(o("#"+this._mClientHintId).html("你下载内容包含文件夹，需要使用百度云管家。").show(),l=!1):o("#"+this._mClientHintId).html("").hide()}else o("#"+this._mClientHintId).html("").hide();if(this.putIconifyName(l),r.checkAvailability()){try{this.setGuanjiaVersion()}catch(u){return s&&console.log("GetVersion()方法错误"),r.doError(),void this.dialog.hide()}if(this._mOpts.ct="pcygj",this._mOpts.cv=g.guanjiaVersion,n.getCurrentProduct()!==n.PRODUCT_PAN)if(n.getCurrentProduct()===n.PRODUCT_MBOX){if(g.guanjiaVersion<r.GUANJIA_VERSION_COMPARE){var I=o("#"+this._mMsgId+"_videoGuideBox"),v=I.find(".guideHeader"),D=I.find(".guidePreview");return v.hide(),D.hide(),this._mIsVideo?this.videoTypePreview(i,t):o("#"+this._mPositiveVideoId).hide(),o(".download-mgr-dialog-text").hide(),void o("#"+this._mClientHintId).html("您的云管家版本太低，请安装新版本").show()}(!this._mIsVideo||i)&&(d.useToast({toastMode:"loading",msg:"正在获取下载链接，请稍后..."}),this._mOpts.isForGuanjia=!0,n.getDlinkMbox(this._mOpts,function(i){d.useCloseToast(),r.callClientDownload(void 0,i.list)}))}else n.getCurrentProduct()===n.PRODUCT_SHARE&&this._doCallGuanjiaForShare();else(!this._mIsVideo||i)&&this.doCallGuanjia();this._mIsVideo&&!i?(o("#"+this._mPositiveVideoId).css("display",""),o("#"+this._mNegativeVideoId).css("display","none"),o(".g-button-right span","#"+this._mPositiveVideoId).html(h.ISSVIP&&1===+h.ISSVIP?'<em class="d-svip-icon"></em>超级会员极速下载':1===+h.ISVIP?'<em class="d-vip-icon"></em>会员高速下载':"高速下载（推荐）"),this.dialog.show()):this.dialog.hide()}else{if(navigator.userAgent.toLowerCase().search(/chrome/)>0&&0===o("div.chromeUpgradeHelpTip",this.dialog.$dialog).length){var L=o('<div class="chromeUpgradeHelpTip" style="text-align: center;position:relative;margin-bottom:20px;"><a style="color:#FF0000;text-decoration:underline;" href="Baiduyunguanjia://guanjia">已安装新版云管家，仍无法下载，点击启动服务</a></div>');o("div.dlg-ft",this.dialog.$dialog).after(L),L.bind("click",function(){e.dialog.hide(),setTimeout(function(){r.initConnector(),setTimeout(function(){e._mMode=g.MODE_PRE_INSTALL,e.updateMode(1)},500)},3e3)})}this._mFirst?this.dialog.show():(this._mFirst=!0,this.dialog.hide(),r.initConnector(),setTimeout(function(){e._mMode=g.MODE_PRE_INSTALL,e.updateMode(1)},500)),a.getContext().log.send({page:d.getDownloadLogmsg(),type:this.isHugeFile()?"DownloadPluginDisplayForceHugeOptions":"DownloadPluginDisplayForceNonhugeOptions"})}l||a.getContext().log.send({page:d.getDownloadLogmsg(),type:g.logMsg.category+"-"+g.logMsg.actionCompulsoryPlugin});break;case g.MODE_POST_INSTALL:n.getCurrentProduct()===n.PRODUCT_MBOX?(o("#"+this._mPositiveId).attr("href",r.getDownloadGuanjiaUrlOfNew()),o("#"+this._mPositiveVideoId).attr("href",r.getDownloadGuanjiaUrl())):(o("#"+this._mPositiveId).attr("href",r.getDownloadGuanjiaUrl()),o("#"+this._mPositiveVideoId).attr("href",r.getDownloadGuanjiaUrl())),o("#"+this._mClientHintId).css("display","none"),o("#"+this._mMsgId).removeClass("download-mgr-tight").html("<p>安装完成后，重启浏览器即可高速下载</p>"),o("#"+this._mPositiveId).css("display","none"),o("#"+this._mPositiveVideoId).css("display","none"),o("#"+this._mNegativeId).css("display",""),o("#"+this._mNegativeVideoId).css("display",""),o("span","#"+this._mNegativeId).text("知道了"),o("#"+this._mNegativeVideoId).text("知道了"),o("#"+this._mNegativeId).show(),o("#"+this._mPositiveVideoId).parent().hide(),o("#"+this._mPositiveId).parent().show(),this.dialog.show();break;case g.MODE_DIRECT_DOWNLOAD:e.dispatchNegativeEvent()}this.videoTypePreview(i,t)},g.prototype._doCallGuanjiaForShare=function(){var i=function(i,t,e){var s,l=[],g=[],_=i,c=a.getContext().tools.baseService.getCookie("BDCLND");if("number"!=typeof i._mList.length)s={},s.isdir="0",s.md5=i._mList.md5,s.server_path=i._mList.path,s.size=String(i._mList.size),s.shareid=t,s.uk=e,s.token=c||"",s.fs_id=i._mList.fs_id,i._mList.dlink?s.link=d.getDownloadUrl(i._mList):g.push(i._mList.fs_id),l=[s];else for(var p=null,m=0,u=i._mList.length;u>m;m++)s={},p=i._mList[m],s.isdir=String(p.isdir),s.md5=p.md5||"",s.size=String(p.size||0),s.server_path=p.path,s.uk=e,s.shareid=t,s.token=c||"",s.fs_id=p.fs_id,p.dlink||p.isdir?s.link=p.dlink&&d.getDownloadUrl(p)||"":g.push(p.fs_id),l.push(s);g.length>0?(d.useToast({toastMode:"loading",msg:"正在获取下载链接，请稍后..."}),n.getDlinkShare(i._mOpts,function(i){d.useCloseToast(),l=_.getFormatedLinkList(l,i.list),r.callClientDownload(l)})):(o.get("/share/autoincre",{type:1,uk:h.SHARE_UK,shareid:h.SHARE_ID,sign:h.SIGN,timestamp:h.TIMESTAMP}),r.callClientDownload(l))};return function(){g.guanjiaVersion<r.GUANJIA_VERSION_COMPARE?i(this,h.SHARE_ID,h.SHARE_UK):(d.useToast({toastMode:"loading",msg:"正在获取下载链接，请稍后...",autoClose:!1}),this._mOpts.isForGuanjia=!0,n.getDlinkShare(this._mOpts,function(i){d.useCloseToast(),r.callClientDownload(void 0,i.list)}))}}(),g.prototype.doCallGuanjia=function(){var i,t=[],e=[],s=this;if("number"!=typeof this._mList.length)i={},i.isdir="0",i.md5=this._mList.md5,i.server_path=this._mList.path,i.size=String(this._mList.size),i.shareid="",i.uk="",i.token="",i.fs_id=this._mList.fs_id,this._mList.dlink?i.link=d.getDownloadUrl(this._mList):e.push(this._mList.fs_id),t=[i];else for(var o=null,a=0,l=this._mList.length;l>a;a++)i={},o=this._mList[a],i.isdir=String(o.isdir),i.md5=o.md5||"",i.size=String(o.size||0),i.server_path=o.path,i.uk="",i.shareid="",i.token="",i.fs_id=o.fs_id,o.dlink||o.isdir?i.link=o.dlink&&d.getDownloadUrl(o)||"":e.push(o.fs_id),t.push(i);e.length>0?(d.useToast({toastMode:"loading",msg:"正在获取下载链接，请稍后...",autoClose:!1}),n.getDlinkPan(n.getFsidListData(this._mList),"dlink",function(i){0===i.errno&&(d.useCloseToast(),t=s.getFormatedLinkList(t,i.dlink),r.callClientDownload(t))},"pcygj",g.guanjiaVersion)):r.callClientDownload(t)},g.prototype.getFormatedLinkList=function(i,t){for(var e,s=0,o=i.length;o>s;s++){e=i[s];for(var a=t.length-1;a>=0;a--)e.fs_id==t[a].fs_id&&(e.link=t[a].dlink||"",t.splice(a,1))}return i},g.prototype.dispatchNegativeEvent=function(){switch(this._mMode){case g.MODE_PRE_DOWNLOAD:a.getContext().log.send({page:d.getDownloadLogmsg(),type:g.logMsg.category+"-"+g.logMsg.actionOrdinaryDownload}),s&&console.log("small file download ? "+this.isSmallFile()),this.dialog.hide(),d.useCloseToast(),this.preDownload();break;case g.MODE_PRE_INSTALL:break;case g.MODE_POST_INSTALL:case g.MODE_POST_RETRY:s&&console.log("report client download installation issue"),this.dialog.hide(),a.getContext().log.send({page:d.getDownloadLogmsg(),type:g.logMsg.category+"-"+g.logMsg.actionDownReportIssue});break;case g.MODE_DIRECT_DOWNLOAD:a.getContext().log.send({page:d.getDownloadLogmsg(),type:this.isSmallFile()?"DownloadPluginLowSmallFileDownload":"DownloadPluginLowBatchFilesDownload"}),s&&console.log("small file download ? "+this.isSmallFile()),this.dialog.hide(),this.directDownload();break;case g.MODE_SMALLVIDEO_PRE_DOWNLOAD:this.preDownload()}},g.prototype.directDownload=function(){var i={},t=this;this._mOpts.isForBatch=!1,n.getCurrentProduct()===n.PRODUCT_MBOX?n.getDlinkMbox(this._mOpts,function(e){i.dlink=e.list[0].dlink,g.straightforwardDownload(i,t._mList)}):n.getCurrentProduct()===n.PRODUCT_SHARE?n.getDlinkShare(this._mOpts,function(e){i.dlink=e.list[0].dlink,g.straightforwardDownload(i,t._mList)}):this._mList.dlink&&/^https?:\/\//.test(this._mList.dlink)?(i=this._mList,g.straightforwardDownload(i,this._mList)):n.getDlinkPan(n.getFsidListData(this._mList),"dlink",function(e){i.dlink=e.dlink[0].dlink,g.straightforwardDownload(i,t._mList)})},g.prototype.preDownload=function(){var i={},t=this;_.isArray(this._mList)===!0?(this._mOpts.isForBatch=!0,n.getCurrentProduct()===n.PRODUCT_MBOX?n.getDlinkMbox(this._mOpts,function(e){i.dlink=e.dlink+"&zipname="+encodeURIComponent(d.getPackName(t._mList)),g.straightforwardDownload(i,t._mList)}):n.getCurrentProduct()===n.PRODUCT_SHARE?n.getDlinkShare(this._mOpts,function(e){i.dlink=e.dlink+"&zipname="+encodeURIComponent(d.getPackName(t._mList)),g.straightforwardDownload(i,t._mList)}):n.getDlinkPan(n.getFsidListData(this._mList),"batch",function(e){i.dlink=e.dlink+"&zipname="+encodeURIComponent(d.getPackName(t._mList)),g.straightforwardDownload(i,t._mList)})):(this._mOpts.isForBatch=!1,n.getCurrentProduct()===n.PRODUCT_MBOX?n.getDlinkMbox(this._mOpts,function(e){i.dlink=e.list[0].dlink,g.straightforwardDownload(i,t._mList)}):n.getCurrentProduct()===n.PRODUCT_SHARE?n.getDlinkShare(this._mOpts,function(e){i.dlink=e.list[0].dlink,g.straightforwardDownload(i,t._mList)}):n.getDlinkPan(n.getFsidListData([this._mList]),"dlink",function(e){i.dlink=e.dlink[0].dlink,g.straightforwardDownload(i,t._mList)}))},g.prototype.dispatchPositiveEvent=function(){var i=!1;switch(this._mMode){case g.MODE_PRE_DOWNLOAD:this._mMode=g.MODE_PRE_INSTALL,a.getContext().log.send({page:d.getDownloadLogmsg(),type:g.logMsg.category+"-"+g.logMsg.actionAccelerateDownload}),this.updateMode(1);break;case g.MODE_PRE_INSTALL:this._mIsVideo&&r.checkAvailability()||(this._mMode=g.MODE_POST_INSTALL),n.getCurrentProduct()===n.PRODUCT_MBOX&&g.guanjiaVersion<r.GUANJIA_VERSION_COMPARE&&(this._mMode=g.MODE_POST_INSTALL),setTimeout(function(){a.getContext().log.send({page:d.getDownloadLogmsg(),type:g.logMsg.category+"-"+g.logMsg.actionDownloadClient})},1e3),this.updateMode(1),i=!0;break;case g.MODE_POST_INSTALL:case g.MODE_POST_RETRY:r.checkAvailability()?(this.dialog.hide(),this._mMode==g.MODE_POST_INSTALL&&a.getContext().log.send({page:d.getDownloadLogmsg(),type:"downloadPluginCompleteInstall",version:"1.0.0.0"}),r.callClientDownload(this._mList,this._mGuanjiaString)):(s&&console.log("on post install, we hav't got client plugin yet"),this._mMode=g.MODE_POST_RETRY,this.updateMode(1),this._mIsVideo&&(i=!0))}return i},g.prototype.showBuyVipPkgGuide=function(){1!==+h.ISSVIP&&o("#show-buyvip-pack").length>0&&(o("#show-buyvip-pack").fadeIn("200"),a.getContext().log.send({url:"//pan.baidu.com/api/analytics",type:"download_buyvip_view"}))},g.prototype.queryIp=function(){var i="/rest/2.0/membership/isp?method=query",t=this;1==h.LOGINSTATUS&&(t._mIsVideo||o.ajax({url:i,type:"POST",data:{user_id:1},success:function(i){var e=null;try{e=o.parseJSON(i),e.isp_name&&""!==e.isp_name&&1===+h.ISSVIP?(t._mIspName=e.isp_name,o("#show-acceleration-pack").length&&o("#show-acceleration-pack").fadeIn("200"),a.getContext().log.send({page:d.getDownloadLogmsg(),url:"//pan.baidu.com/api/analytics",type:"check_isp_name"})):t.showBuyVipPkgGuide()}catch(n){s&&console.log("[LOG]====>parse json error on get user products ",n.message)}},error:function(i){s&&console.log(i);var t,e,a,n=i.responseText;try{t=o.parseJSON(responseText),e=t.error_code,a=disk.util.buyErrorMessage[e]}catch(d){s&&console.log(n)}}}))},e.exports=g});
;define("disk-system:widget/plugin/download/controller/downloadController.js",function(o,t,i){var n=(o("base:widget/libs/jquerypacket.js"),o("base:widget/libs/underscore.js")),a=o("disk-system:widget/plugin/download/service/downloadManager.js"),e=o("disk-system:widget/plugin/download/service/downloadDirectService.js"),s=o("disk-system:widget/plugin/download/util/downloadCommonUtil.js"),d=o("disk-system:widget/plugin/download/util/context.js"),r=o("disk-system:widget/plugin/download/service/dlinkService.js"),l={opts:{},downloadManageService:null,calculateMode:function(o){var t,i=0,e=0;if(n.isArray(o)===!0)for(var d=0;d<o.length;d++)i+=parseInt(o[d].size),1==parseInt(o[d].isdir)?e=1:"";else i=parseInt(o.size),e=o.isdir;if(n.isArray(o)===!0)return a.logMsg.category=a.logMsg.multipleFileCategory,o.length>a.FILES_NUMBER||i>a.MEDIUM_SIZE_FILE||1==e?a.MODE_PRE_INSTALL:a.MODE_PRE_DOWNLOAD;a.logMsg.category=a.logMsg.singleFileCategory,a.initSingleFileToGuanjiaLimit();var t=a.SIZE_THRESHOLD;return s.isChromeAndGreaterThan42()&&(t=a.SIZE_THRESHOLD_CHROME),1==e?a.MODE_PRE_INSTALL:s.isChrome()&&".exe"===o.server_filename.substr(-4,4)?a.MODE_PRE_INSTALL:i<a.SMALL_SIZE_FILE?a.MODE_DIRECT_DOWNLOAD:i>=a.SMALL_SIZE_FILE&&t>i?a.MODE_PRE_DOWNLOAD:a.MODE_PRE_INSTALL},downloadByManager:function(o,t){var i,e;n.isArray(o)===!0?(i=d.getContext().tools.baseService.parseDirFromPath(o[0].path),e=d.getContext().tools.baseService.parseDirFromPath(o[0].path)):(i=d.getContext().tools.baseService.parseDirFromPath(o.path),e=d.getContext().tools.baseService.parseDirFromPath(o.path)),null===this.downloadManageService?this.downloadManageService=new a(o,i,e,t,this.opts):this.downloadManageService.setDependencyData(o,i,e,t,this.opts),this.downloadManageService.setMode(this.calculateMode(o)),this.downloadManageService.initDialog(),this.downloadManageService.dialog.show(),this.downloadManageService.updateMode()},downloadInWindows:function(){var o,t=this.opts.list,i=t.length,n=this.opts.hasDlink||!1;switch(i){case 1:o=t[0],n===!1?this.downloadByManager(0==o.isdir?o:[o]):e.straightforwardDownload(o,t);break;default:this.downloadByManager(t)}},downloadInNotWindows:function(){switch(this.opts.product){case r.PRODUCT_PAN:this.downloadPanInNotWindows();break;case r.PRODUCT_MBOX:this.downloadMboxInNotWindows();break;case r.PRODUCT_SHARE:this.downloadShareInNotWindows();break;default:this.downloadPanInNotWindows()}},downloadPanInNotWindows:function(){var o=this.opts.list,t=o.length,i=this.opts.hasDlink||!1,n={};switch(t){case 1:n=o[0],i===!1?1==n.isdir?r.getDlinkPan(r.getFsidListData([n]),"batch",function(t){n.dlink=t.dlink,e.straightforwardDownload(n,o)}):r.getDlinkPan(r.getFsidListData([n]),"dlink",function(o){n.dlink=o.dlink[0].dlink,e.straightforwardDownload(n,n)}):e.straightforwardDownload(n,n);break;default:r.getDlinkPan(r.getFsidListData(o),"batch",function(t){n.dlink=t.dlink+"&zipname="+encodeURIComponent(s.getPackName(o)),e.straightforwardDownload(n,o)})}},downloadMboxInNotWindows:function(){var o=this.opts,t=this.opts.list,i=t.length,n=o.hasDlink||!1,a={};switch(i){case 1:a=t[0],n===!1?1==a.isdir?(o.isForBatch=!0,r.getDlinkMbox(o,function(o){a.dlink=o.dlink,e.straightforwardDownload(a,t)})):(o.isForBatch=!1,r.getDlinkMbox(o,function(o){a.dlink=o.list[0].dlink,e.straightforwardDownload(a,a)})):e.straightforwardDownload(a,a);break;default:o.isForBatch=!0,r.getDlinkMbox(o,function(o){a.dlink=o.dlink+"&zipname="+encodeURIComponent(s.getPackName(t)),e.straightforwardDownload(a,t)})}},downloadShareInNotWindows:function(){var o=this.opts,t=this.opts.list,i=t.length,n=o.hasDlink||!1,a={};switch(i){case 1:a=t[0],n===!1?1==a.isdir?(o.isForBatch=!0,r.getDlinkShare(o,function(o){a.dlink=o.dlink,e.straightforwardDownload(a,t)})):(o.isForBatch=!1,r.getDlinkShare(o,function(o){a.dlink=o.list[0].dlink,e.straightforwardDownload(a,a)})):e.straightforwardDownload(a,a);break;default:o.isForBatch=!0,r.getDlinkShare(o,function(o){a.dlink=o.dlink+"&zipname="+encodeURIComponent(s.getPackName(t)),e.straightforwardDownload(a,t)})}}},w={download:function(o){var t=o.list,i=t.length;return 0===i?void s.useToast({msg:"您还没有选择下载的文件"}):(l.opts=o,r.setCurrentProduct(o.product?o.product:r.PRODUCT_PAN),void(s.isPlatformWindows()===!0?l.downloadInWindows():l.downloadInNotWindows()))}};i.exports=w});
;define("disk-system:widget/plugin/download/start.js",function(s,t,e){var i=(s("base:widget/libs/underscore.js"),s("disk-system:widget/plugin/download/util/context.js"));s("disk-system:widget/plugin/download/service/guanjiaConnector.js");var n={start:function(t,e){var n,l=null;i.setContext(t),"object"==typeof e&&e.filesList?(l=e.filesList.length>0?e.filesList:[e.filesList],n=e.hasDlink):"string"==typeof e?(l=[{dlink:e}],n=!0):l=t.list.getSelected(),s.async("disk-system:widget/plugin/download/controller/downloadController.js",function(s){s.download({list:l,hasDlink:n})})}};e.exports=n});
;define("disk-system:widget/plugin/download/view/downloadDialog.tpl.js",function(a,s,n){var l=[];l.push('<div class="module-download-dilaog">'),l.push('<div id="topTips" class="g-clearfix g-center download-mgr-banner download-mgr-client-hint"></div><div class="content"><div node-type="message-tip" class="message-tip g-center">加载中&hellip;</div></div><div class="dlg-ft"><div class="g-clearfix g-center"><a node-type="download-speedup" class="btn btn-blue btn-blue-long btn-blue-high" href="javascript:void(0);"><span class="text text-normal">加速下载（推荐）</span></a><a node-type="download-normal" class="btn btn-gray btn-gray-long btn-gray-high" href="javascript:void(0);"><span class="text text-normal">普通下载</span></a><span node-type="guanjia-tip" class="download-mgr-hint download-mgr-hint-l special-mgr-left" style="display: block;"><em></em>多文件<b>不限文件个数</b><br>下载<b>更稳定</b></span><span node-type="normal-tip" class="download-mgr-hint download-mgr-hint-r"><em></em>浏览器单线程下载</span></div></div>'),l.push('<div class="dlg-ft01 b-rlv" id="show-acceleration-pack">'),l.push('    <div class="g-clearfix g-center acceleration-pack">'),l.push('        <span class="dowmload-imgs-style dowmload-imgs-style01"></span>'),l.push('        <span class="dowmload-content-style">使用网络加速包,即可为你最高</span>'),l.push('        <span class="download-upspeed-style">提速300%</span>'),l.push('        <a href="javascript:window.open(\'/buy/center?tag=2&frm=dl#network\')"class="download-change-link-style">立即购买</a>'),l.push("    </div>"),l.push("</div>"),l.push('</div">'),n.exports={downloadDialog:l.join("")}});